<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cofre da Sorte</title>
  
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='imagens/favicon.png') }}">
  
  <!-- Fonte (Apple-like) -->
 <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
  
  <!-- reCAPTCHA v3 -->
  <script src="https://www.google.com/recaptcha/api.js?render=6Lc2-q8qAAAAAF8c69VaSI1SRKIenNoCi-GCgTKv"></script>
</head>
<body onload="updateClock('{{ safe.reset_time.isoformat() }}')">

  <div id="preloader">
    <div id="preloaderText"></div>
    <div id="progressBar">
        <div id="progressFill"></div>
    </div>
 </div>
  
    <!-- A trilha (fundo) e a barra -->
    <div class="progress-track">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>

  <!-- Cabeçalho minimalista (pode estar vazio) -->
  <header class="apple-header"></header>

  <!-- 
    LINKS RÁPIDOS NO TOPO 
    Botões estilo Apple-like, inclusive "Prêmio do Cofre"
    que rola até a parte de prêmio.
  -->
  <section class="quick-links-container">
    <h2>Links rápidos</h2>
    <div class="quick-links-buttons">
      <!-- Botão 1: Post da Promoção -->
      <a 
        class="link-button" 
        href="https://www.instagram.com/p/POST_OFICIAL" 
        target="_blank"
      >
        Post da Promoção ↗
      </a>

      <!-- Botão 2: Seja um patrocinador (leva ao WhatsApp) -->
      <a 
        class="link-button" 
        href="https://wa.me/5531996765285"
        target="_blank"
      >
        Seja um patrocinador ↗
      </a>

      <!-- Botão 3: Tentar a Sorte (scroll até o formulário do cofre) -->
      <a 
        class="link-button" 
        href="#form-cofre"
      >
        Tentar a Sorte ↗
      </a>

      <!-- Botão 4: “Prêmio do Cofre” (leva ao ID da seção do prêmio) -->
      <a 
        class="link-button"
        href="#premio-cofre"
      >
        Prêmio do Cofre ↗
      </a>
      <!-- Botão 5: “Regras” (leva ao ID da seção do prêmio) -->
      <a 
        class="link-button"
        href="#premio-cofre"
      >
        Regras Cofre ↗
      </a>
    </div>
  </section>
  <!-- Menu Hambúrguer (somente visível no mobile) -->
<div class="mobile-nav">
  <!-- Ícone de hambúrguer (☰) -->
  <button class="hamburger-button" onclick="toggleMobileMenu()">
    ☰
  </button>

  <!-- Menu que expande ao clicar -->
  <ul class="mobile-menu" id="mobileMenu">
    <li><a href="https://www.instagram.com/p/POST_OFICIAL" target="_blank">Post da Promoção ↗</a></li>
    <li><a href="https://wa.me/5531996765285" target="_blank">Seja um patrocinador ↗</a></li>
    <li><a href="#form-cofre">Tentar a Sorte ↗</a></li>
    <li><a href="#premio-cofre">Prêmio do Cofre ↗</a></li>
    <li><a href="#premio-cofre">Regras Cofre ↗</a></li>
  </ul>
</div>

  <!-- Hero Text - maior e alinhado à esquerda -->
  <section class="hero-section">
    <h1 class="hero-title">Hoje é o seu dia de sorte?</h1>
    <p class="hero-subtitle">Descubra agora mesmo ao abrir o Cofre da Sorte.</p>
  </section>

 <!-- ======================================
     Carrossel que se adapta (Mobile/Desktop)
======================================= -->
<div class="banner-slideshow" id="bannerSlideshow">

  <!-- SLIDES PARA MOBILE (2) -->
  <div class="slide mobile-slide" id="mobileSlide1"></div>
  <div class="slide mobile-slide" id="mobileSlide2"></div>

  <!-- SLIDES PARA DESKTOP (2) -->
  <div class="slide desktop-slide" id="desktopSlide1"></div>
  <div class="slide desktop-slide" id="desktopSlide2"></div>

  <!-- Bolinhas (dots) para MOBILE -->
  <div class="dots-container mobile-only" id="mobileDots">
    <span class="dot mobile-dot active" data-slide="0"></span>
    <span class="dot mobile-dot" data-slide="1"></span>
  </div>

  <!-- Bolinhas (dots) para DESKTOP -->
  <div class="dots-container desktop-only" id="desktopDots">
    <span class="dot desktop-dot active" data-slide="0"></span>
    <span class="dot desktop-dot" data-slide="1"></span>
  </div>
</div>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flashes">
      {% for category, message in messages %}
        <div class="message-banner {{ category }}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}
    
    <!-- Texto “Escolha 6 números de 1 a 60” (ou 69) acima do Formulário -->
    <section class="numbers-instruction">
      <h2>Escolha 6 números de 1 a 60</h2>
    </section>
    
    <!-- Formulário (Cofre) -->
    <section class="form-container-section" id="form-cofre">
      <form method="POST" class="form-container" onsubmit="onSubmit(event)">
        {{ form.hidden_tag() }}

        <div class="form-group">
          <label for="username">Seu @ do Instagram</label>
          <input 
            type="text"
            id="username"
            name="username"
            required
            placeholder="@seuusuario"
            maxlength="100"
          >
        </div>

        <!-- Exibição dos Números Selecionados -->
        <div class="digit-display">
          <span id="digit1"></span>
          <span id="digit2"></span>
          <span id="digit3"></span>
          <span id="digit4"></span>
          <span id="digit5"></span>
          <span id="digit6"></span>
        </div>

        <!-- Grade de Seleção de Números -->
        <div class="numbers-grid">
          {% for i in range(1, 61) %}
            <button 
              type="button"
              class="num-btn"
              onclick="toggleNumber(this, '{{ i }}')"
              aria-pressed="false"
            >{{ i }}</button>
          {% endfor %}
        </div>

        <!-- Campo Oculto para Armazenar os Números -->
        <input type="hidden" id="numbers" name="numbers" value="">

        <!-- Campo oculto para o token do reCAPTCHA -->
      <input type="hidden" id="recaptchaResponse" name="g-recaptcha-response">
      
        <!-- Botão de Envio -->
        <button type="submit" class="submit-btn">Tentar Abrir o Cofre</button>
      </form>

      <!-- Relógio de Contagem Regressiva -->
      <div class="clock-container">
        <p>Tempo para o reset: <span id="clock"></span></p>
      </div>

      <!-- Lista de Tentativas Recentes -->
       
      <section class="attempts-list-container">
        <section class="attempts-list">
          <h2>Tentativas Recentes</h2>
          <ul>
            {% for attempt in attempts %}
              {% if safe.winner == attempt.username %}
                <!-- Se for o vencedor (o "winner" do cofre), exibe mensagem de acerto -->
                <li>
                  {{ attempt.timestamp.strftime('%d/%m/%Y %H:%M:%S') }} - 
                  Parabéns, você acertou a senha: {{ attempt.attempt }}
                </li>
              {% else %}
                <!-- Caso contrário, exibe "senha incorreta" -->
                <li>
                  {{ attempt.timestamp.strftime('%d/%m/%Y %H:%M:%S') }} - 
                  {{ attempt.username }} - senha incorreta: {{ attempt.attempt }}
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        </section>
      </section>

    <div class="banner-header">
      <h2 id="unique-title">Últimos Ganhadores</h2>
      <p id="unique-subtitulo">Seja você o próximo.</p>
  </div>
  
  <!-- Banners (para exibir lado a lado no desktop e scroll horizontal no mobile) -->
 <!-- Banners (para exibir lado a lado no desktop e scroll horizontal no mobile) -->
 <div class="banner-container">
  <div class="banner-item">
      <img src="/static/imagens/avatar1.jpg" alt="avatar1">
      <h2>Primeiro Ganhador</h2>
      <p>2 Mil Reais</p>
      <a href="#">Veja mais</a>
  </div>
  <div class="banner-item">
      <img src="/static/imagens/avatar2.jpg" alt="avatar2">
      <h2>Segundo Ganhador </h2>
      <p>Carregando...</p>
      <a href="#">Veja mais</a>
  </div>
  <div class="banner-item">
      <img src="/static/imagens/avatar3.jpg" alt="avatar3">
      <h2>Terceiro Ganhador</h2>
      <p>Carregando</p>
      <a href="#">Veja mais</a>
  </div>
</div>
  
  

    <!-- Seção do Prêmio e Regras (adicione um ID para ancorar com "Prêmio do Cofre") -->
    <section class="prize-info improved-box" id="premio-cofre">
      <div class="prize-header">
        <h2 class="prize-title">Prêmio do Cofre</h2>
        <p class="prize-subtitle">Um prêmio exclusivo esperando por você.</p>
      </div>
      <div class="prize-content">
        <p>
          Este cofre contém: <strong>{{ safe.prize }}</strong>, oferecido pelo patrocinador.
        </p>
        <p>
          Para participar, siga o perfil do patrocinador: 
          <a href="https://www.instagram.com/patrocinador_oficial" target="_blank">@patrocinador_oficial</a> 
          e interaja no 
          <a href="https://www.instagram.com/p/POST_OFICIAL" target="_blank">Post Oficial</a>.
        </p>
      </div>
      <div class="rules-container">
        <h3>Regras para Ganhar</h3>
        <ul>
          <li>↗ Seguir <strong>@patrocinador_oficial</strong> no Instagram antes de abrir o cofre.</li>
          <li>↗ Curtir e comentar no Post Oficial <strong>antes</strong> de abrir o cofre.</li>
          <li>↗ O vencedor será validado pela ordem das ações (seguir, curtir, comentar e compartilhar.).</li>
          <li>↗ Caso não tenha cumprido todas as regras <em>antes</em> de abrir o cofre, perde o direito ao prêmio.</li>
        </ul>
      </div>
    </section>
  </main>

  <!-- Rodapé -->
  <footer class="apple-footer">
    <div class="footer-info">
      <h3>Como funciona o Cofre da Sorte </h3>
      <p>
        O Cofre da Sorte é um sistema de premiação online que permite que qualquer pessoa participe 
        usando apenas seu @ do Instagram. Não coletamos dados sensíveis, apenas o necessário 
        para validar suas tentativas e identificar o(a) vencedor(a).
      </p>
      <p>
        A cada reset, uma nova combinação é gerada. Se você acertar, ganha o prêmio. 
        Mas lembre-se de seguir todas as regras de participação para não perder sua chance!
      </p>
      <p style="font-size: 0.9rem; color: #666;">
        Nós da equipe Cofre da Sorte nos resguardamos quanto a eventuais erros ou 
        instabilidades no site que possam impedir as tentativas momentaneamente. 
        Em caso de dúvidas, entre em contato conosco.
      </p>
    </div>
    <p style="font-size: 0.9rem; color: #666; margin-top:1rem;">
      Cofre da Sorte - Direitos Reservados 2024
    </p>
  
    <p style="margin-top: 1rem; font-size: 0.8rem; color: #666;">
      Este site utiliza SSL/TLS e reCAPTCHA para proteger seus dados fique tranquilo.
    </p>
  </footer>

      <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PYMW6C1RB0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PYMW6C1RB0');
</script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const preloader = document.getElementById('preloader');
        const progressFill = document.getElementById('progressFill');
        const preloaderText = document.getElementById('preloaderText');

        // Array de frases
        const frases = [
            "Carregando sua sorte...",
            "Abrir o cofre sem regras? Não vale!",
            "Hoje é seu dia de sorte!",
            "Cuidado! Sem regras, sem prêmio!",
            "Prepare-se para ganhar!",
            "Só mais um instante...",
            "Se não seguiu as regras, perdeu!",
            "A sorte está a caminho...",
            "Que a sorte esteja com você!",
            "Verificando suas possibilidades..."
        ];

        function iniciarPreloader() {
            // Verifica se é a primeira visita
            const hasVisitedBefore = localStorage.getItem('visitedBefore');
            
            if (!hasVisitedBefore) {
                // Exibe uma frase aleatória
                const fraseAleatoria = frases[Math.floor(Math.random() * frases.length)];
                preloaderText.textContent = fraseAleatoria;
                
                // Garante que o preloader está visível
                preloader.style.display = 'flex';
                
                // Inicia com 0%
                progressFill.style.width = '0%';

                // Contador para simular o progresso até 90%
                let progress = 0;
                const progressInterval = setInterval(() => {
                    if (progress < 90) {
                        progress += 1;
                        progressFill.style.width = progress + '%';
                    }
                }, 30);

                // Aguarda o carregamento completo da página
                window.addEventListener('load', function() {
                    clearInterval(progressInterval);
                    // Completa até 100% rapidamente
                    progressFill.style.width = '100%';
                    
                    // Aguarda um breve momento após atingir 100%
                    setTimeout(() => {
                        preloader.style.display = 'none';
                        localStorage.setItem('visitedBefore', 'true');
                    }, 500);
                });
            } else {
                // Se não for a primeira visita, esconde o preloader imediatamente
                preloader.style.display = 'none';
            }
        }
        // Inicia o preloader
        iniciarPreloader();

      // Rola a página para o topo quando o site for carregado
    window.scrollTo(0, 0);
    });
    </script>


  <script>
    // Lógica para seleção de números
    let selectedNumbers = [];
    function toggleNumber(button, number) {
      const num = parseInt(number, 10);
      if (selectedNumbers.includes(num)) {
        selectedNumbers = selectedNumbers.filter(n => n !== num);
        button.classList.remove('selected');
        button.setAttribute('aria-pressed', 'false');
      } else if (selectedNumbers.length < 6) {
        selectedNumbers.push(num);
        button.classList.add('selected');
        button.setAttribute('aria-pressed', 'true');
      }
      updateDisplay();
    }

    function updateDisplay() {
      const display = document.querySelectorAll('.digit-display span');
      display.forEach((span, index) => {
        span.textContent = selectedNumbers[index] || '';
        if (selectedNumbers[index]) {
          span.classList.add('selected');
        } else {
          span.classList.remove('selected');
        }
      });
      const hiddenInput = document.querySelector("input[name='numbers']");
      hiddenInput.value = selectedNumbers.join(',');
    }

    // Relógio (countdown)
    function updateClock(resetTime) {
      const resetDate = new Date(resetTime);
      const now = new Date();
      const diff = resetDate - now;

      if (diff <= 0) {
        document.getElementById("clock").innerText = "Resetando...";
        return;
      }

      const hours = Math.floor(diff / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      document.getElementById("clock").innerText = `${hours}h ${minutes}m ${seconds}s`;

      if (diff > 0) {
        setTimeout(() => updateClock(resetTime), 1000);
      }
    }
  </script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
  
    // Descobre se a tela é "mobile" ou "desktop" via Media Query
    const isMobile = window.matchMedia("(max-width: 768px)").matches;
  
    let slides = [];
    let dots = [];
  
    if (isMobile) {
      // ========== MOBILE ==========
      const slideM1 = document.getElementById('mobileSlide1');
      const slideM2 = document.getElementById('mobileSlide2');
      // Defina as imagens para cada slide mobile
      slideM1.style.backgroundImage = "url('/static/imagens/mobile-banner1.png')";
      slideM2.style.backgroundImage = "url('/static/imagens/mobile-banner2.png')";
  
      slides = [slideM1, slideM2];
      dots = document.querySelectorAll('.mobile-dot');
  
    } else {
      // ========== DESKTOP ==========
      const slideD1 = document.getElementById('desktopSlide1');
      const slideD2 = document.getElementById('desktopSlide2');
      // Defina as imagens para cada slide desktop
      slideD1.style.backgroundImage = "url('/static/imagens/desktop-banner1.png')";
      slideD2.style.backgroundImage = "url('/static/imagens/desktop-banner2.png')";
  
      slides = [slideD1, slideD2];
      dots = document.querySelectorAll('.desktop-dot');
    }
  
    // Agora configura o carrossel com os slides e dots que realmente existem no dispositivo
    let currentSlide = 0;
  
    function showSlide(index) {
      // Remove active de todos
      slides.forEach(s => s.classList.remove('active'));
      dots.forEach(d => d.classList.remove('active'));
  
      // Ativa o slide e a bolinha correspondente
      slides[index].classList.add('active');
      dots[index].classList.add('active');
  
      currentSlide = index;
    }
  
    function nextSlide() {
      let newIndex = currentSlide + 1;
      if (newIndex >= slides.length) {
        newIndex = 0;
      }
      showSlide(newIndex);
    }
  
    // Troca automaticamente a cada 5 segundos
    let slideInterval = setInterval(nextSlide, 5000);
  
    // Ao clicar nos dots, troca manual
    dots.forEach((dot, i) => {
      dot.addEventListener('click', function() {
        showSlide(i);
        clearInterval(slideInterval);
        slideInterval = setInterval(nextSlide, 5000);
      });
    });
  
    // Exibe inicialmente o slide 0
    if (slides.length > 0) {
      showSlide(0);
    }
  });
  </script>

<script>
  function toggleMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    menu.classList.toggle('open');
  }
</script>

 <script>
  // Função do reCAPTCHA - envia o token invisível ao backend
  function onSubmit(event) {
    event.preventDefault();
    grecaptcha.ready(function() {
      grecaptcha.execute('6Lc2-q8qAAAAAF8c69VaSI1SRKIenNoCi-GCgTKv', {action: 'login'}).then(function(token) {
        // Adiciona o token ao formulário
        document.getElementById('recaptchaResponse').value = token;
        document.forms[0].submit(); // Submete o formulário
      });
    });
  }
</script>
  
</body>
</html>
